{"ast":null,"code":"var _jsxFileName = \"/Users/jy/Desktop/chatdemo-react/src/components/Chat.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport Axios from 'axios';\nimport { useRecoilState, useRecoilValue } from 'recoil';\nimport { RoomId } from '../atoms';\nimport SockJs from 'react-stomp';\nimport Stomp from 'stompjs';\n\nfunction Chat() {\n  let sockJS = new SockJs(\"http://localhost:8080/ws-stomp\");\n  let stompClient = Stomp.over(sockJS);\n\n  stompClient.debug = () => {};\n\n  const [roomId, setRoomId] = useRecoilState(RoomId);\n  const [room, setRoom] = useState('');\n  const [sender, setSender] = useState('');\n  const [chat, setChat] = useState('');\n  const [msgs, setMsgs] = useState([]);\n  useEffect(() => {\n    stompClient.connect({}, () => {\n      stompClient.subscribe(`/sub/chat/room/${roomId}`, msg => {\n        const newMessage = JSON.parse(msg.body);\n        recvMessage(newMessage);\n      });\n      stompClient.send(\"/pub/chat/message\", {}, JSON.stringify({\n        type: 'ENTER',\n        roomId: roomId,\n        sender: sender\n      }));\n    });\n  }, [msgs]);\n  useEffect(() => {\n    setSender('Guest'); //setSender(prompt(\"여기에 이름을 입력\"))\n  }, []);\n  useEffect(() => {\n    if (roomId !== '') {\n      Axios.get(`http://localhost:8080/chat/room/${roomId}`).then(res => {\n        console.log(\"res : \" + res.data);\n        setRoom(res.data);\n      });\n    }\n  }, [roomId]);\n\n  const recvMessage = recv => {\n    console.log(recv);\n    setMsgs([{\n      \"type\": recv.type,\n      \"sender\": recv.type == 'ENTER' ? '[알림]' : recv.sender,\n      \"message\": recv.message\n    }, ...msgs]);\n  };\n\n  const sendMessage = () => {\n    console.log(chat);\n\n    if (chat != '') {\n      // stompClient.send(\"/pub/chat/message\", {}, JSON.stringify({type:'TALK', roomId:roomId, sender:sender, message:chat}));\n      setChat('');\n    }\n  };\n\n  const onChange = e => {\n    setChat(e.target.value); // 우선 e.target 에서 name 과 value 를 추출\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setRoomId(''),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 13\n    }\n  }, \"\\uB4A4\\uB85C\\uAC00\\uAE30\"), /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }\n  }, \"\\uBC29\\uC81C : \", room.name), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  }, \"\\uB098 : \", sender), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"name\",\n    value: chat,\n    onKeyUp: onChange,\n    placeholder: \"\\uC5EC\\uAE30\\uC5D0 \\uBA54\\uC138\\uC9C0 \\uC785\\uB825\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 102\n    }\n  }, \"\\uBCF4\\uB0B4\\uAE30\"), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }\n  }, msgs.map(msg => /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 34\n    }\n  }, msg))));\n}\n\nexport default Chat;","map":{"version":3,"sources":["/Users/jy/Desktop/chatdemo-react/src/components/Chat.js"],"names":["React","useState","useEffect","useRef","Axios","useRecoilState","useRecoilValue","RoomId","SockJs","Stomp","Chat","sockJS","stompClient","over","debug","roomId","setRoomId","room","setRoom","sender","setSender","chat","setChat","msgs","setMsgs","connect","subscribe","msg","newMessage","JSON","parse","body","recvMessage","send","stringify","type","get","then","res","console","log","data","recv","message","sendMessage","onChange","e","target","value","name","map"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef} from 'react'\nimport Axios from 'axios';\nimport { useRecoilState, useRecoilValue } from 'recoil';\nimport {RoomId} from '../atoms'\nimport SockJs from 'react-stomp'\nimport Stomp from 'stompjs';\n\n\nfunction Chat(){\n\n    let sockJS = new SockJs(\"http://localhost:8080/ws-stomp\");\n    let stompClient = Stomp.over(sockJS);\n    stompClient.debug= () => {};\n    \n    const [roomId,setRoomId] = useRecoilState(RoomId)\n\n    const [room, setRoom] = useState('')\n    const [sender, setSender] = useState('')\n\n    const [chat, setChat] = useState('')\n    const [msgs, setMsgs] = useState([])\n\n    useEffect(()=>{\n        stompClient.connect({},()=>{\n          stompClient.subscribe(`/sub/chat/room/${roomId}`,(msg)=>{\n            const newMessage = JSON.parse(msg.body) ;\n            recvMessage(newMessage);\n          });\n          stompClient.send(\"/pub/chat/message\", {}, JSON.stringify({type:'ENTER', roomId:roomId, sender:sender}));\n      });\n      },[msgs]);\n    \n    useEffect(()=>{\n        setSender('Guest')\n        //setSender(prompt(\"여기에 이름을 입력\"))\n    },[])\n\n    useEffect(() => {\n        if (roomId !== ''){\n            Axios.get(`http://localhost:8080/chat/room/${roomId}`)\n            .then(res=> { \n                console.log(\"res : \" + res.data)\n                setRoom(res.data) \n            });\n        }\n    },[roomId])\n    \n    const recvMessage = (recv) => {\n        console.log(recv)\n        setMsgs([\n            {\"type\":recv.type,\"sender\":recv.type=='ENTER'?'[알림]':recv.sender,\"message\":recv.message},\n            ...msgs])\n    }\n\n    const sendMessage = () => {\n        console.log(chat)\n        if (chat != ''){\n            // stompClient.send(\"/pub/chat/message\", {}, JSON.stringify({type:'TALK', roomId:roomId, sender:sender, message:chat}));\n            setChat('')\n        }\n    }\n\n    const onChange = (e) => {\n        setChat(e.target.value); // 우선 e.target 에서 name 과 value 를 추출\n      };\n    \n    return (\n        <div> \n            <button onClick={()=>setRoomId('')}>뒤로가기</button>\n            <h1>방제 : {room.name}</h1>\n            <h2>나 : {sender}</h2>\n            <input type=\"text\" name=\"name\" value={chat} onKeyUp={onChange} placeholder=\"여기에 메세지 입력\"/><button onClick={sendMessage}>보내기</button>\n            <ul>\n                {msgs.map(msg => <li>{msg}</li>)}\n            </ul>\n        </div>\n    )\n}\n\n\nexport default Chat\n\n\n"]},"metadata":{},"sourceType":"module"}