{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = jsonFetch;\nObject.defineProperty(exports, \"retriers\", {\n  enumerable: true,\n  get: function get() {\n    return _retriers.default;\n  }\n});\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nrequire(\"isomorphic-fetch\");\n\nvar _promiseRetry = _interopRequireDefault(require(\"promise-retry\"));\n\nvar _get_request_options = _interopRequireDefault(require(\"./get_request_options\"));\n\nvar _retriers = _interopRequireDefault(require(\"./retriers\")); // eslint-disable-line\n\n\nvar DEFAULT_RETRY_OPTIONS = {\n  retries: 0\n};\n\nvar DEFAULT_SHOULD_RETRY = function DEFAULT_SHOULD_RETRY() {\n  return false;\n};\n\nfunction jsonFetch(_x) {\n  return _jsonFetch.apply(this, arguments);\n}\n\nfunction _jsonFetch() {\n  _jsonFetch = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(requestUrl) {\n    var jsonFetchOptions,\n        expectedStatuses,\n        response,\n        jsonFetchResponse,\n        _args = arguments;\n    return _regenerator.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            jsonFetchOptions = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n            expectedStatuses = jsonFetchOptions.expectedStatuses;\n            _context.prev = 2;\n            _context.next = 5;\n            return retryFetch(requestUrl, jsonFetchOptions);\n\n          case 5:\n            response = _context.sent;\n            _context.next = 8;\n            return createJsonFetchResponse(response);\n\n          case 8:\n            jsonFetchResponse = _context.sent;\n            assertExpectedStatus(expectedStatuses, jsonFetchResponse);\n            return _context.abrupt(\"return\", jsonFetchResponse);\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](2);\n            _context.t0.request = getErrorRequestData({\n              requestUrl: requestUrl,\n              requestOptions: jsonFetchOptions\n            });\n            throw _context.t0;\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this, [[2, 13]]);\n  }));\n  return _jsonFetch.apply(this, arguments);\n}\n\nfunction retryFetch(_x2, _x3) {\n  return _retryFetch.apply(this, arguments);\n}\n\nfunction _retryFetch() {\n  _retryFetch = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3(requestUrl, jsonFetchOptions) {\n    var shouldRetry, retryOptions, requestOptions, response;\n    return _regenerator.default.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            shouldRetry = jsonFetchOptions.shouldRetry || DEFAULT_SHOULD_RETRY;\n            retryOptions = Object.assign({}, DEFAULT_RETRY_OPTIONS, jsonFetchOptions.retry);\n            requestOptions = (0, _get_request_options.default)(jsonFetchOptions);\n            _context3.prev = 3;\n            _context3.next = 6;\n            return (0, _promiseRetry.default)( /*#__PURE__*/function () {\n              var _ref2 = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(throwRetryError, retryCount) {\n                var res;\n                return _regenerator.default.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _context2.prev = 0;\n                        _context2.next = 3;\n                        return fetch(requestUrl, requestOptions);\n\n                      case 3:\n                        res = _context2.sent;\n                        if (shouldRetry(res)) throwRetryError();\n                        return _context2.abrupt(\"return\", res);\n\n                      case 8:\n                        _context2.prev = 8;\n                        _context2.t0 = _context2[\"catch\"](0);\n                        _context2.t0.retryCount = retryCount ? retryCount - 1 : 0;\n                        if (_context2.t0.code !== 'EPROMISERETRY' && shouldRetry(_context2.t0)) throwRetryError(_context2.t0);\n                        throw _context2.t0;\n\n                      case 13:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, this, [[0, 8]]);\n              }));\n\n              return function (_x5, _x6) {\n                return _ref2.apply(this, arguments);\n              };\n            }(), retryOptions);\n\n          case 6:\n            response = _context3.sent;\n            return _context3.abrupt(\"return\", response);\n\n          case 10:\n            _context3.prev = 10;\n            _context3.t0 = _context3[\"catch\"](3);\n            _context3.t0.name = 'FetchError';\n            throw _context3.t0;\n\n          case 14:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this, [[3, 10]]);\n  }));\n  return _retryFetch.apply(this, arguments);\n}\n\nfunction createJsonFetchResponse(_x4) {\n  return _createJsonFetchResponse.apply(this, arguments);\n}\n\nfunction _createJsonFetchResponse() {\n  _createJsonFetchResponse = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee4(response) {\n    var responseText;\n    return _regenerator.default.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return response.text();\n\n          case 2:\n            responseText = _context4.sent;\n            return _context4.abrupt(\"return\", {\n              status: response.status,\n              statusText: response.statusText,\n              headers: response.headers,\n              text: responseText,\n              body: getResponseBody(response, responseText)\n            });\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this);\n  }));\n  return _createJsonFetchResponse.apply(this, arguments);\n}\n\nfunction createErrorResponse(response, responseText) {\n  // do not include headers as they potentially contain sensitive information\n  return {\n    status: response.status,\n    statusText: response.statusText,\n    text: responseText\n  };\n}\n\nfunction getResponseBody(response, responseText) {\n  if (isApplicationJson(response.headers)) try {\n    return JSON.parse(responseText);\n  } catch (err) {\n    err.response = createErrorResponse(response, responseText);\n    throw err;\n  }\n  return undefined;\n}\n\nfunction isApplicationJson(headers) {\n  var responseContentType = headers.get('Content-Type') || '';\n  return /application\\/json/.test(responseContentType);\n}\n\nfunction assertExpectedStatus(expectedStatuses, jsonFetchResponse) {\n  if (Array.isArray(expectedStatuses) && !expectedStatuses.includes(jsonFetchResponse.status)) {\n    var err = new Error(\"Unexpected fetch response status \".concat(jsonFetchResponse.status));\n    err.name = 'FetchUnexpectedStatusError'; // $FlowFixMe\n\n    err.response = jsonFetchResponse;\n    throw err;\n  }\n}\n\nfunction getErrorRequestData(_ref) {\n  var requestUrl = _ref.requestUrl,\n      requestOptions = _ref.requestOptions;\n  var data = Object.assign({}, requestOptions, {\n    url: requestUrl\n  }); // do not include headers as they potentially contain sensitive information\n\n  delete data.headers;\n  return data;\n}","map":{"version":3,"sources":["/Users/jy/Desktop/chatdemo-react/node_modules/json-fetch/lib/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","jsonFetch","enumerable","get","_retriers","_regenerator","_asyncToGenerator2","_promiseRetry","_get_request_options","DEFAULT_RETRY_OPTIONS","retries","DEFAULT_SHOULD_RETRY","_x","_jsonFetch","apply","arguments","mark","_callee","requestUrl","jsonFetchOptions","expectedStatuses","response","jsonFetchResponse","_args","wrap","_callee$","_context","prev","next","length","undefined","retryFetch","sent","createJsonFetchResponse","assertExpectedStatus","abrupt","t0","request","getErrorRequestData","requestOptions","stop","_x2","_x3","_retryFetch","_callee3","shouldRetry","retryOptions","_callee3$","_context3","assign","retry","_ref2","_callee2","throwRetryError","retryCount","res","_callee2$","_context2","fetch","code","_x5","_x6","name","_x4","_createJsonFetchResponse","_callee4","responseText","_callee4$","_context4","text","status","statusText","headers","body","getResponseBody","createErrorResponse","isApplicationJson","JSON","parse","err","responseContentType","test","Array","isArray","includes","Error","concat","_ref","data","url"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = jsonFetch;\nObject.defineProperty(exports, \"retriers\", {\n  enumerable: true,\n  get: function get() {\n    return _retriers.default;\n  }\n});\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nrequire(\"isomorphic-fetch\");\n\nvar _promiseRetry = _interopRequireDefault(require(\"promise-retry\"));\n\nvar _get_request_options = _interopRequireDefault(require(\"./get_request_options\"));\n\nvar _retriers = _interopRequireDefault(require(\"./retriers\"));\n\n// eslint-disable-line\nvar DEFAULT_RETRY_OPTIONS = {\n  retries: 0\n};\n\nvar DEFAULT_SHOULD_RETRY = function DEFAULT_SHOULD_RETRY() {\n  return false;\n};\n\nfunction jsonFetch(_x) {\n  return _jsonFetch.apply(this, arguments);\n}\n\nfunction _jsonFetch() {\n  _jsonFetch = (0, _asyncToGenerator2.default)(\n  /*#__PURE__*/\n  _regenerator.default.mark(function _callee(requestUrl) {\n    var jsonFetchOptions,\n        expectedStatuses,\n        response,\n        jsonFetchResponse,\n        _args = arguments;\n    return _regenerator.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            jsonFetchOptions = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n            expectedStatuses = jsonFetchOptions.expectedStatuses;\n            _context.prev = 2;\n            _context.next = 5;\n            return retryFetch(requestUrl, jsonFetchOptions);\n\n          case 5:\n            response = _context.sent;\n            _context.next = 8;\n            return createJsonFetchResponse(response);\n\n          case 8:\n            jsonFetchResponse = _context.sent;\n            assertExpectedStatus(expectedStatuses, jsonFetchResponse);\n            return _context.abrupt(\"return\", jsonFetchResponse);\n\n          case 13:\n            _context.prev = 13;\n            _context.t0 = _context[\"catch\"](2);\n            _context.t0.request = getErrorRequestData({\n              requestUrl: requestUrl,\n              requestOptions: jsonFetchOptions\n            });\n            throw _context.t0;\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this, [[2, 13]]);\n  }));\n  return _jsonFetch.apply(this, arguments);\n}\n\nfunction retryFetch(_x2, _x3) {\n  return _retryFetch.apply(this, arguments);\n}\n\nfunction _retryFetch() {\n  _retryFetch = (0, _asyncToGenerator2.default)(\n  /*#__PURE__*/\n  _regenerator.default.mark(function _callee3(requestUrl, jsonFetchOptions) {\n    var shouldRetry, retryOptions, requestOptions, response;\n    return _regenerator.default.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            shouldRetry = jsonFetchOptions.shouldRetry || DEFAULT_SHOULD_RETRY;\n            retryOptions = Object.assign({}, DEFAULT_RETRY_OPTIONS, jsonFetchOptions.retry);\n            requestOptions = (0, _get_request_options.default)(jsonFetchOptions);\n            _context3.prev = 3;\n            _context3.next = 6;\n            return (0, _promiseRetry.default)(\n            /*#__PURE__*/\n            function () {\n              var _ref2 = (0, _asyncToGenerator2.default)(\n              /*#__PURE__*/\n              _regenerator.default.mark(function _callee2(throwRetryError, retryCount) {\n                var res;\n                return _regenerator.default.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        _context2.prev = 0;\n                        _context2.next = 3;\n                        return fetch(requestUrl, requestOptions);\n\n                      case 3:\n                        res = _context2.sent;\n                        if (shouldRetry(res)) throwRetryError();\n                        return _context2.abrupt(\"return\", res);\n\n                      case 8:\n                        _context2.prev = 8;\n                        _context2.t0 = _context2[\"catch\"](0);\n                        _context2.t0.retryCount = retryCount ? retryCount - 1 : 0;\n                        if (_context2.t0.code !== 'EPROMISERETRY' && shouldRetry(_context2.t0)) throwRetryError(_context2.t0);\n                        throw _context2.t0;\n\n                      case 13:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, this, [[0, 8]]);\n              }));\n\n              return function (_x5, _x6) {\n                return _ref2.apply(this, arguments);\n              };\n            }(), retryOptions);\n\n          case 6:\n            response = _context3.sent;\n            return _context3.abrupt(\"return\", response);\n\n          case 10:\n            _context3.prev = 10;\n            _context3.t0 = _context3[\"catch\"](3);\n            _context3.t0.name = 'FetchError';\n            throw _context3.t0;\n\n          case 14:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this, [[3, 10]]);\n  }));\n  return _retryFetch.apply(this, arguments);\n}\n\nfunction createJsonFetchResponse(_x4) {\n  return _createJsonFetchResponse.apply(this, arguments);\n}\n\nfunction _createJsonFetchResponse() {\n  _createJsonFetchResponse = (0, _asyncToGenerator2.default)(\n  /*#__PURE__*/\n  _regenerator.default.mark(function _callee4(response) {\n    var responseText;\n    return _regenerator.default.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return response.text();\n\n          case 2:\n            responseText = _context4.sent;\n            return _context4.abrupt(\"return\", {\n              status: response.status,\n              statusText: response.statusText,\n              headers: response.headers,\n              text: responseText,\n              body: getResponseBody(response, responseText)\n            });\n\n          case 4:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4, this);\n  }));\n  return _createJsonFetchResponse.apply(this, arguments);\n}\n\nfunction createErrorResponse(response, responseText) {\n  // do not include headers as they potentially contain sensitive information\n  return {\n    status: response.status,\n    statusText: response.statusText,\n    text: responseText\n  };\n}\n\nfunction getResponseBody(response, responseText) {\n  if (isApplicationJson(response.headers)) try {\n    return JSON.parse(responseText);\n  } catch (err) {\n    err.response = createErrorResponse(response, responseText);\n    throw err;\n  }\n  return undefined;\n}\n\nfunction isApplicationJson(headers) {\n  var responseContentType = headers.get('Content-Type') || '';\n  return /application\\/json/.test(responseContentType);\n}\n\nfunction assertExpectedStatus(expectedStatuses, jsonFetchResponse) {\n  if (Array.isArray(expectedStatuses) && !expectedStatuses.includes(jsonFetchResponse.status)) {\n    var err = new Error(\"Unexpected fetch response status \".concat(jsonFetchResponse.status));\n    err.name = 'FetchUnexpectedStatusError'; // $FlowFixMe\n\n    err.response = jsonFetchResponse;\n    throw err;\n  }\n}\n\nfunction getErrorRequestData(_ref) {\n  var requestUrl = _ref.requestUrl,\n      requestOptions = _ref.requestOptions;\n  var data = Object.assign({}, requestOptions, {\n    url: requestUrl\n  }); // do not include headers as they potentially contain sensitive information\n\n  delete data.headers;\n  return data;\n}"]},"metadata":{},"sourceType":"script"}