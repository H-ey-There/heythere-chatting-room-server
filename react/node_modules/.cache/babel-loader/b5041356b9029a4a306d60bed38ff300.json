{"ast":null,"code":"var _jsxFileName = \"/Users/jy/Desktop/heythere2/heythere-chattingroom-server/chatdemo-react/src/components/Chat.js\";\nimport React, { useState, useEffect, useRef } from 'react';\nimport Axios from 'axios';\nimport { useRecoilState, useRecoilValue } from 'recoil';\nimport { RoomId, Sender } from '../atoms';\nimport SockJsClient from 'react-stomp';\n\nfunction Chat() {\n  let $websocket = useRef(null);\n  const [roomId, setRoomId] = useRecoilState(RoomId);\n  const sender = useRecoilValue(Sender);\n  const [chat, setChat] = useState('');\n  const [room, setRoom] = useState({\n    host: ''\n  });\n  const [msg, setMsg] = useState([]);\n  useEffect(() => {\n    console.log(\"get room\");\n\n    if (roomId !== '') {\n      Axios.get(`http://localhost:8080/chat/room/${roomId}`).then(res => {\n        setRoom(res.data);\n        load(room);\n      });\n    } // setRoomId('')\n\n  }, []);\n\n  const recvMessage = recv => {\n    console.log(\"received: \", recv.message);\n\n    if (recv.type === 'EXIT') {\n      setRoomId('');\n      return;\n    }\n\n    setMsg([{\n      \"type\": recv.type,\n      \"sender\": recv.type === 'ENTER' ? '[알림]' : recv.sender,\n      \"message\": recv.message\n    }, ...msg]);\n  };\n\n  const sendMessage = e => {\n    if (chat !== '') {\n      $websocket.current.sendMessage('/pub/chat/message', JSON.stringify({\n        type: 'TALK',\n        roomId: roomId,\n        sender: sender.name,\n        message: chat\n      }), {\n        'Content-Type': 'application/json'\n      });\n    }\n  };\n\n  const onChange = e => {\n    setChat(e.target.value);\n  };\n\n  const exit = () => {\n    $websocket.current.sendMessage('/pub/chat/message', JSON.stringify({\n      type: 'EXIT',\n      roomId: roomId,\n      sender: sender.name,\n      message: ''\n    }), {\n      'Content-Type': 'application/json'\n    });\n    setRoomId('');\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: exit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 13\n    }\n  }, \"\\uB4A4\\uB85C\\uAC00\\uAE30\"), /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }\n  }, \"\\uBC29\\uC81C : \", room.name), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  }, \"\\uB098 : \", sender.name), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"name\",\n    onKeyUp: onChange,\n    placeholder: \"\\uC5EC\\uAE30\\uC5D0 \\uBA54\\uC138\\uC9C0 \\uC785\\uB825\",\n    onKeyPress: e => {\n      if (e.key === \"Enter\") {\n        sendMessage(e);\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }\n  }, \"\\uBCF4\\uB0B4\\uAE30\"), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 17\n    }\n  }, msg.map(m => /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 35\n    }\n  }, m.sender, \": \", m.message)))), /*#__PURE__*/React.createElement(SockJsClient, {\n    url: \"http://localhost:8080/ws-stomp\",\n    topics: ['/sub/chat/room/' + roomId],\n    onConnect: () => {\n      $websocket.current.sendMessage('/pub/chat/message', JSON.stringify({\n        type: 'ENTER',\n        roomId: roomId,\n        sender: sender.name,\n        message: ''\n      }), {\n        'Content-Type': 'application/json'\n      });\n    },\n    onMessage: msg => recvMessage(msg),\n    ref: $websocket,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }\n  }));\n}\n\nexport default Chat;","map":{"version":3,"sources":["/Users/jy/Desktop/heythere2/heythere-chattingroom-server/chatdemo-react/src/components/Chat.js"],"names":["React","useState","useEffect","useRef","Axios","useRecoilState","useRecoilValue","RoomId","Sender","SockJsClient","Chat","$websocket","roomId","setRoomId","sender","chat","setChat","room","setRoom","host","msg","setMsg","console","log","get","then","res","data","load","recvMessage","recv","message","type","sendMessage","e","current","JSON","stringify","name","onChange","target","value","exit","key","map","m"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef} from 'react'\nimport Axios from 'axios';\nimport {useRecoilState, useRecoilValue} from 'recoil';\nimport {RoomId, Sender} from '../atoms'\nimport SockJsClient from 'react-stomp'\n\nfunction Chat(){\n    let $websocket = useRef(null);\n\n    const [roomId, setRoomId] = useRecoilState(RoomId)\n    const sender = useRecoilValue(Sender);\n\n    const [chat, setChat] = useState('')\n    const [room, setRoom] = useState({\n        host: ''\n    })\n\n    const [msg, setMsg] = useState([])\n\n    useEffect(()=>{\n        console.log(\"get room\")\n        if (roomId !== ''){\n            Axios.get(`http://localhost:8080/chat/room/${roomId}`)\n            .then(res=> { \n                setRoom(res.data)\n                load(room)\n            });\n        }\n        // setRoomId('')\n\n      },[]);\n    \n    const recvMessage = (recv) => {\n        console.log(\"received: \",recv.message)\n        if (recv.type === 'EXIT') {\n            setRoomId('')\n            return\n        }\n        setMsg([\n            {\"type\":recv.type,\"sender\":recv.type === 'ENTER'?'[알림]':recv.sender,\"message\":recv.message},\n            ...msg])\n    }\n\n    const sendMessage = (e) => {\n        if (chat !== ''){\n            $websocket.current.sendMessage (\n                '/pub/chat/message',\n                JSON.stringify({type:'TALK', roomId:roomId, sender:sender.name, message:chat}),\n                {'Content-Type': 'application/json'}\n            )\n        }\n    }\n\n    const onChange = (e) => {\n        setChat(e.target.value);\n      };\n\n    const exit = () => {\n        $websocket.current.sendMessage (\n            '/pub/chat/message',\n            JSON.stringify({type:'EXIT', roomId:roomId, sender:sender.name, message:''}),\n            {'Content-Type': 'application/json'})\n        setRoomId('')\n    }\n    \n    return (\n        <div> \n            <button onClick={exit}>뒤로가기</button>\n\n            <h1>방제 : {room.name}</h1>\n            <h2>나 : {sender.name}</h2>\n\n            <input type=\"text\" name=\"name\"  onKeyUp={onChange} placeholder=\"여기에 메세지 입력\" \n                onKeyPress={e => {if (e.key === \"Enter\"){\n                    sendMessage(e)\n\n                }}}/>\n            <button onClick={sendMessage}>보내기</button>\n\n            <div>\n                <ul>\n                    {msg.map(m => <li>{m.sender}: {m.message}</li>)}\n                </ul>\n            </div>\n\n            <SockJsClient \n                url=\"http://localhost:8080/ws-stomp\" \n                topics={['/sub/chat/room/'+roomId]}\n                onConnect={()=>{\n                    $websocket.current.sendMessage (\n                        '/pub/chat/message',\n                        JSON.stringify({type:'ENTER', roomId:roomId, sender:sender.name, message:''}),\n                        {'Content-Type': 'application/json'}\n                    )\n                }}\n                onMessage={msg => recvMessage(msg)}\n                ref={$websocket}/>\n        </div>\n    )\n}\n\n\nexport default Chat\n\n\n"]},"metadata":{},"sourceType":"module"}