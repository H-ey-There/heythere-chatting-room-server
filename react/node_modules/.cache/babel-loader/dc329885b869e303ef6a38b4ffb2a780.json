{"ast":null,"code":"var _jsxFileName = \"/Users/jy/Desktop/chatdemo-react/src/components/Chat2.js\";\nimport React, { useEffect, useState } from 'react';\nimport SockJsClient from \"react-stomp\";\nimport UsernameGenerator from \"username-generator\";\nimport Fetch from \"json-fetch\";\nimport { TalkBox } from \"react-talk\";\nimport randomstring from \"randomstring\";\nimport { useRecoilState } from 'recoil';\nimport { RoomId } from '../atoms';\nimport Axios from 'axios';\n\nfunction Chat2() {\n  useEffect(() => {\n    if (roomId !== '') {\n      Axios.get(`http://localhost:8080/chat/room/${roomId}`).then(res => {\n        setRoom(res.data);\n      });\n    } // stompClient.send(\"/pub/chat/message\", {}, JSON.stringify({type:'ENTER', roomId:roomId, sender:sender}));\n\n  }, [roomId]);\n  const [roomId, setRoomId] = useRecoilState(RoomId);\n  const [room, setRoom] = useState('');\n  const randomUserName = \"Guest\";\n  const randomUserId = randomstring.generate();\n  const sendURL = \"/message\";\n  const [status, setStatus] = useState({\n    clientConnected: false,\n    messages: []\n  });\n\n  const onMessageReceive = (msg, topic) => {\n    //alert(JSON.stringify(msg) + \" @ \" +  JSON.stringify(this.state.messages)+\" @ \" + JSON.stringify(topic));\n    this.setState(prevState => ({\n      messages: [...prevState.messages, msg]\n    }));\n  };\n\n  useEffect(() => {\n    console.log(\"call history\");\n    Fetch(\"/history\", {\n      method: \"GET\"\n    }).then(response => {\n      setStatus({\n        messages: response.body\n      });\n    });\n  }, []);\n\n  const sendMessage = (msg, selfMsg) => {\n    try {\n      var send_message = {\n        \"user\": selfMsg.author,\n        \"message\": selfMsg.message\n      };\n      this.clientRef.sendMessage(\"/app/message\", JSON.stringify(send_message));\n      return true;\n    } catch (e) {\n      return false;\n    }\n  };\n\n  const wsSourceUrl = \"http://localhost:8080/chatting\";\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(TalkBox, {\n    topic: \"/topic/public\",\n    currentUserId: randomUserId,\n    currentUser: randomUserName,\n    messages: status.messages,\n    onSendMessage: sendMessage,\n    connected: status.clientConnected,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(SockJsClient, {\n    url: wsSourceUrl,\n    topics: [\"/topic/public\"],\n    onMessage: onMessageReceive //   ref={ (client) => { clientRef = client }}\n    ,\n    onConnect: () => {\n      setStatus({\n        clientConnected: true\n      });\n    },\n    onDisconnect: () => {\n      setStatus({\n        clientConnected: false\n      });\n    },\n    debug: false,\n    style: [{\n      width: '100%',\n      height: '100%'\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 9\n    }\n  }));\n}\n\nexport default Chat2;","map":{"version":3,"sources":["/Users/jy/Desktop/chatdemo-react/src/components/Chat2.js"],"names":["React","useEffect","useState","SockJsClient","UsernameGenerator","Fetch","TalkBox","randomstring","useRecoilState","RoomId","Axios","Chat2","roomId","get","then","res","setRoom","data","setRoomId","room","randomUserName","randomUserId","generate","sendURL","status","setStatus","clientConnected","messages","onMessageReceive","msg","topic","setState","prevState","console","log","method","response","body","sendMessage","selfMsg","send_message","author","message","clientRef","JSON","stringify","e","wsSourceUrl","width","height"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react';\nimport SockJsClient from \"react-stomp\";\nimport UsernameGenerator from \"username-generator\";\nimport Fetch from \"json-fetch\";\nimport { TalkBox } from \"react-talk\";\nimport randomstring from\"randomstring\";\nimport { useRecoilState } from 'recoil';\nimport { RoomId } from '../atoms';\nimport Axios from 'axios';\n\n\nfunction Chat2() {\n\n    useEffect(()=>{\n        if (roomId !== ''){\n            Axios.get(`http://localhost:8080/chat/room/${roomId}`)\n            .then(res=> { \n                setRoom(res.data) \n            });\n        }\n        \n\n        // stompClient.send(\"/pub/chat/message\", {}, JSON.stringify({type:'ENTER', roomId:roomId, sender:sender}));\n      },[roomId]);\n\n    const [roomId,setRoomId] = useRecoilState(RoomId)\n    const [room, setRoom] = useState('')\n    const randomUserName = \"Guest\"\n    const randomUserId = randomstring.generate();\n    const sendURL = \"/message\";\n    const [status, setStatus] = useState(      \n        {clientConnected : false,\n        messages : []\n    })\n\n  const onMessageReceive = (msg, topic) => {\n    //alert(JSON.stringify(msg) + \" @ \" +  JSON.stringify(this.state.messages)+\" @ \" + JSON.stringify(topic));\n    this.setState(prevState => ({\n      messages: [...prevState.messages, msg]\n    }));\n  }\n\n  useEffect(() => {\n    console.log(\"call history\");\n    Fetch(\"/history\", {\n      method: \"GET\"\n    }).then((response) => {\n      setStatus({ messages: response.body });\n    });\n  }, [])\n\n  const sendMessage = (msg, selfMsg) => {\n    try {\n      var send_message = {\n        \"user\" : selfMsg.author,\n        \"message\" : selfMsg.message\n      }\n      this.clientRef.sendMessage(\"/app/message\", JSON.stringify(send_message));\n      return true;\n    } catch(e) {\n      return false;\n    }\n  }\n    const wsSourceUrl = \"http://localhost:8080/chatting\";\n    return (\n      <div>\n        <TalkBox topic=\"/topic/public\" currentUserId={ randomUserId }\n          currentUser={randomUserName } messages={status.messages }\n          onSendMessage={ sendMessage } connected={ status.clientConnected }/>\n        \n        <SockJsClient url={ wsSourceUrl } topics={[\"/topic/public\"]}\n          onMessage={ onMessageReceive } \n        //   ref={ (client) => { clientRef = client }}\n          onConnect={ () => {setStatus({ clientConnected: true }) } }\n          onDisconnect={ () => {setStatus({ clientConnected: false }) } }\n          debug={ false } style={[{width:'100%', height:'100%'}]}/>\n      </div>\n    );\n  \n}\n\nexport default Chat2;\n"]},"metadata":{},"sourceType":"module"}